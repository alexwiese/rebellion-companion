<div *ngIf="loading == true" class="loader">Loading..</div>

<div *ngIf="loading == false">
  <p-messages [value]="errors"></p-messages>
  <div *ngIf="loaded">
    <p-panel>
      <p-header *ngIf="personComplianceItem.id === getEmptyGuid()">
        Add Compliance Item
      </p-header>
      <p-header *ngIf="personComplianceItem.id !== getEmptyGuid()">
        Edit Compliance Item
      </p-header>
      <form [formGroup]="personComplianceItemForm" (ngSubmit)="onSubmit(personComplianceItemForm.value)">
        <div class="ui-grid ui-grid-responsive ui-grid-pad ui-fluid">
          <div class="ui-grid-row aed-row">
            <div class="ui-grid-col-2">
              Compliance Item *
            </div>
            <div class="ui-grid-col-6">
              <p-dropdown [options]="complianceItems" [style]="{'width': '100%'}" [(ngModel)]="personComplianceItem.complianceItemId" formControlName="complianceItemId"
                [autoWidth]="true"></p-dropdown>
            </div>
            <div class="ui-grid-col-4">
              <div class="ui-message ui-messages-error ui-corner-all" *ngIf="personComplianceItemForm.controls['complianceItemId'].hasError('required') && personComplianceItemForm.dirty">
                Compliance Item is required
              </div>
            </div>
          </div>

          <div class="ui-grid-row aed-row">
            <div class="ui-grid-col-2">
              Reference *
            </div>
            <div class="ui-grid-col-6">
              <input pInputText type="text" formControlName="reference" placeholder="Reference..." />
            </div>
            <div class="ui-grid-col-4">
              <div class="ui-message ui-messages-error ui-corner-all" *ngIf="personComplianceItemForm.controls['reference'].hasError('required') && personComplianceItemForm.dirty">
                Reference is required
              </div>
              <div class="ui-message ui-messages-error ui-corner-all" *ngIf="personComplianceItemForm.controls['reference'].hasError('maxlength') && personComplianceItemForm.dirty">
                Reference can't be more than 100 characters
              </div>
            </div>
          </div>

          <div class="ui-grid-row aed-row">
            <div class="ui-grid-col-2">
              Start Date *
            </div>
            <div class="ui-grid-col-6">
              <p-calendar id="startDate" formControlName="startDate" [showIcon]="true" dateFormat="dd/mm/yy"></p-calendar>
            </div>
            <div class="ui-grid-col-4">
              <div class="ui-message ui-messages-error ui-corner-all" *ngIf="personComplianceItemForm.controls['startDate'].hasError('required') && personComplianceItemForm.controls['startDate'].dirty">
                Start Date is required
              </div>
            </div>
          </div>

          <div class="ui-grid-row aed-row">
            <div class="ui-grid-col-2">
              Expiry Date *
            </div>
            <div class="ui-grid-col-6">
              <p-calendar id="endDate" formControlName="expiryDate" [showIcon]="true" dateFormat="dd/mm/yy"></p-calendar>
            </div>
            <div class="ui-grid-col-4">
              <div class="ui-message ui-messages-error ui-corner-all" *ngIf="personComplianceItemForm.controls['expiryDate'].hasError('required') && personComplianceItemForm.controls['expiryDate'].dirty">
                Expiry Date is required
              </div>
            </div>
          </div>

          <div class="ui-grid-row aed-row" *ngIf="displayVerified()">
            <div class="ui-grid-col-2">
              Is Verified
            </div>
            <div class="ui-grid-col-6">
              <p-inputSwitch [disabled]="isVerifiedDisabled" formControlName="isVerified" [(ngModel)]="personComplianceItem.isVerified"></p-inputSwitch>
            </div>
            <div class="ui-grid-col-4">
            </div>
          </div>

          <div *ngIf="uploadingFile" class="loader"></div>
          <div *ngIf="showFileUpload()">
            <div class="ui-grid-row aed-row">
              <div class="context-section aedile-datatable">
                <div *ngIf="uploadingFile == false" class="aed-flex">
                  <div class="aed-flex-item">
                    <div>
                      <img style="max-width: 100%; max-height: 100%;" src="{{ personComplianceItem.fileDisplayUri }}">
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="ui-grid-row aed-row" *ngIf="showFileUpload()">
              <p-fileUpload [style]="{'width':'100%'}" mode="basic" name="personFile" url="{{ uploadFilesUrl }}" accept="image/*" (onError)="onUploadError($event)"
                (onBeforeSend)="onBeforeSend($event)" maxFileSize="5000000" (onUpload)="onUploadFiles($event)" auto="true"
                chooseLabel="Upload Document"></p-fileUpload>
            </div>
          </div>

          <button pButton class="ui-button-info aed-button" type="submit" label="Save" [disabled]="personComplianceItemForm.pristine || personComplianceItemForm.invalid"></button>
          <button pButton class="ui-button-info aed-button" type="submit" (click)="goBack()" label="Cancel"></button>
        </div>
      </form>
    </p-panel>
  </div>
</div>
