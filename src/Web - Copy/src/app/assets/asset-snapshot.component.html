<div *ngIf="loading == true" class="loader">Loading..</div>

<p-messages [value]="errors"></p-messages>

<div *ngIf="loading == false">

  <h2>Asset Snapshot</h2>

  <form [formGroup]="snapshotForm" (ngSubmit)="onSubmit(snapshotForm.value)">
    <div class="card">

      <div class="ui-grid ui-grid-responsive ui-grid-pad ui-fluid">
        <div class="ui-grid-row aed-row">
          <div class="ui-grid-col-1">
            Date *
          </div>
          <div class="ui-grid-col-6">
            <p-calendar id="date" formControlName="snapshotDate" [showIcon]="true" dateFormat="dd/mm/yy" showTime="true" hourFormat="12"></p-calendar>
          </div>
          <div class="ui-grid-col-4">
            <div class="ui-message ui-messages-error ui-corner-all" *ngIf="snapshotForm.controls['snapshotDate'].hasError('required')">
              Snapshot date is required
            </div>
          </div>
        </div>
      </div>

      <div class="ui-grid-row aed-row">
        <div class="ui-grid-col-1">
          Business *
        </div>
        <div class="ui-grid-col-6">
          <p-dropdown wid [options]="businesses" [(ngModel)]="businessId" (onChange)="onChangeBusiness($event)" formControlName="businessId"
            filter="filter" [autoWidth]="true" [style]="{'width': '100%'}" #business></p-dropdown>
        </div>
        <div class="ui-grid-col-4">
          <div class="ui-message ui-messages-error ui-corner-all" *ngIf="snapshotForm.controls['businessId'].hasError('required')">
            Business is required
          </div>
        </div>
      </div>

      <div class="ui-grid-row aed-row">
        <div class="ui-grid-col-1">
          Site *
        </div>
        <div class="ui-grid-col-6">
          <p-dropdown wid [options]="sites" [(ngModel)]="siteId" formControlName="siteId" (onChange)="onChangeSite($event)" filter="filter" [autoWidth]="true" [style]="{'width': '100%'}"
            #site></p-dropdown>
        </div>
        <div class="ui-grid-col-4">
          <div class="ui-message ui-messages-error ui-corner-all" *ngIf="snapshotForm.controls['siteId'].hasError('required')">
            Site is required
          </div>
        </div>
      </div>

      <div class="ui-grid-row aed-row">
        <div class="ui-grid-col-1">
          Building
        </div>
        <div class="ui-grid-col-6">
          <p-dropdown wid [options]="buildings" [(ngModel)]="buildingId" formControlName="buildingId" filter="filter" [autoWidth]="true" [style]="{'width': '100%'}"
            #bulding></p-dropdown>
        </div>
        <div class="ui-grid-col-4">
          <div class="ui-message ui-messages-error ui-corner-all" *ngIf="snapshotForm.controls['buildingId'].hasError('required')">
            Building is required
          </div>
        </div>
      </div>
    </div>

    <div class="ui-grid-row aed-row">
      <button pButton class="ui-button-info aed-button" style="margin: 5px;" type="submit" [disabled]="!snapshotForm.valid" label="Snapshot"></button>
    </div>
  </form>

  <div *ngIf="loading == false" class="context-section aedile-datatable">
    <h2>{{ getHeaderInfo(dt, "Assets") }}</h2>
    <p-dataTable id='asset-datatable' [value]="items" selectionMode="single" [(selection)]="selectedItem" [responsive]="true"
      [rows]="30" [paginator]="true" [pageLinks]="7" [rowsPerPageOptions]="[20,30,50]" [globalFilter]="gb" #dt>
      <p-header>
        <div class="ui-helper-clearfix">
          <i class="fa fa-search" style="margin:4px 4px 0 0; float:left"></i>
          <input #gb type="text" id="filter" pInputText size="50" style="float: left" placeholder="Search Assets">
          <button type="button" pButton icon="fa-arrow-down" iconPos="right" label="Export" (click)="dt.exportCSV()" style="float:right"></button>
        </div>
      </p-header>

      <p-column [sortable]="true" [filter]="false">
        <ng-template pTemplate="header">
          Site Id
        </ng-template>
        <ng-template let-asset="rowData" pTemplate="body">
          <span><a style="color:#d5a940;" [routerLink]="['/site', asset.siteId, 'view']">{{ asset.siteDescription }}</a></span>
        </ng-template>
      </p-column>
      <p-column field="siteName" header="Site Name" [filter]="true" filterMatchMode="in">
        <ng-template pTemplate="filter" let-col>
          <p-multiSelect [options]="sites" defaultLabel="All" (onChange)="dt.filter($event.value, col.field, col.filterMatchMode)"
            styleClass="ui-column-filter"></p-multiSelect>
        </ng-template>
        <ng-template let-asset="rowData" pTemplate="body">
          <span><a style="color:#d5a940;" [routerLink]="['/site', asset.siteId, 'view']">{{ asset.siteName }}</a></span>
        </ng-template>
      </p-column>
      <p-column field="siteObjectTypeName" header="Type" [filter]="true" filterMatchMode="in">
        <ng-template pTemplate="filter" let-col>
          <p-multiSelect [options]="siteObjectTypes" defaultLabel="All" (onChange)="dt.filter($event.value, col.field, col.filterMatchMode)"
            styleClass="ui-column-filter"></p-multiSelect>
        </ng-template>
      </p-column>
      <p-column field="siteObjectDescription" header="Site Object" [filter]="true" filterMatchMode="in">
        <ng-template pTemplate="filter" let-col>
          <p-multiSelect [options]="siteObjectDescriptions" defaultLabel="All" (onChange)="dt.filter($event.value, col.field, col.filterMatchMode)"
            styleClass="ui-column-filter"></p-multiSelect>
        </ng-template>
        <ng-template let-asset="rowData" pTemplate="body">
          <span><a style="color:#d5a940;" [routerLink]="['/siteobject', asset.siteObjectId || '', 'view']">{{ asset.siteObjectDescription || '' }}</a></span>
        </ng-template>
      </p-column>
      <p-column field="identity" header="Asset Id" [filter]="false" filterPlaceholder="Search" [sortable]="true"></p-column>
      <p-column field="name" header="Asset Name" [filter]="false" filterPlaceholder="Search" [sortable]="true"></p-column>
      <p-column field="assetClassName" header="Asset Class" [filter]="false" filterPlaceholder="Search" [sortable]="true"></p-column>
      <p-column field="assetClassLevelOneName" header="Asset Class Level 1" [filter]="false" filterPlaceholder="Search" [sortable]="true"></p-column>
      <p-column field="assetTypeName" header="Asset Type" [filter]="true" filterMatchMode="in">
        <ng-template pTemplate="filter" let-col>
          <p-multiSelect [options]="assetTypes" defaultLabel="All" (onChange)="dt.filter($event.value, col.field, col.filterMatchMode)"
            styleClass="ui-column-filter"></p-multiSelect>
        </ng-template>
      </p-column>
      <p-column field="assetConditionString" header="Condition" [filter]="true" filterMatchMode="in">
        <ng-template pTemplate="filter" let-col>
          <p-multiSelect [options]="conditionTypes" defaultLabel="All" (onChange)="dt.filter($event.value, col.field, col.filterMatchMode)"
            styleClass="ui-column-filter"></p-multiSelect>
        </ng-template>
      </p-column>
      <p-column field="assetStatusString" header="Status" [filter]="true" filterMatchMode="in">
        <ng-template pTemplate="filter" let-col>
          <p-multiSelect [options]="statusTypes" defaultLabel="All" (onChange)="dt.filter($event.value, col.field, col.filterMatchMode)"
            styleClass="ui-column-filter"></p-multiSelect>
        </ng-template>
      </p-column>
      <p-column field="level" header="Floor" [filter]="false" filterPlaceholder="Search" [sortable]="true"></p-column>
      <p-column field="room" header="Room" [filter]="false" filterPlaceholder="Search" [sortable]="true"></p-column>
    </p-dataTable>
    <br>
    <button pButton class="ui-button-info aed-button" type="button" (click)="goBack()" label="Cancel"></button>
    <br>
  </div>

</div>
